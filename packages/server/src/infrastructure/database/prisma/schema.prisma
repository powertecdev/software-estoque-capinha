generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id        String   @id @default(uuid())
  name      String   @unique @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  products  Product[]
  @@map("categories")
}

model PhoneModel {
  id        String   @id @default(uuid())
  brand     String   @db.VarChar(100)
  name      String   @db.VarChar(200)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  products  Product[]
  @@index([brand], name: "idx_phone_brand")
  @@map("phone_models")
}

model Slot {
  id        String   @id @default(uuid())
  label     String   @unique @db.VarChar(50)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  products  Product[]
  @@map("slots")
}

model Product {
  id           String   @id @default(uuid())
  categoryId   String   @map("category_id")
  phoneModelId String   @map("phone_model_id")
  slotId       String   @map("slot_id")
  name         String   @db.VarChar(200)
  price        Decimal  @db.Decimal(10, 2)
  stock        Int      @default(0)
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  category     Category   @relation(fields: [categoryId], references: [id])
  phoneModel   PhoneModel @relation(fields: [phoneModelId], references: [id])
  slot         Slot       @relation(fields: [slotId], references: [id])
  movements    StockMovement[]
  @@index([categoryId], name: "idx_product_category")
  @@index([phoneModelId], name: "idx_product_phone")
  @@index([slotId], name: "idx_product_slot")
  @@map("products")
}

model StockMovement {
  id        String       @id @default(uuid())
  productId String       @map("product_id")
  type      MovementType
  quantity  Int
  reason    String?      @db.VarChar(500)
  createdAt DateTime     @default(now()) @map("created_at")
  product   Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  @@index([productId, createdAt], name: "idx_movement_product_date")
  @@map("stock_movements")
}

enum MovementType {
  ENTRY
  EXIT
}